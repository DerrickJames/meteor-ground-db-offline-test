{"version":3,"sources":["meteor://ðŸ’»app/packages/raix_stubfence/packages/raix_stubfence.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6F","file":"/packages/raix_stubfence.js","sourcesContent":["(function () {\n\n///////////////////////////////////////////////////////////////////////////////////\n//                                                                               //\n// packages/raix:stubfence/util.js                                               //\n//                                                                               //\n///////////////////////////////////////////////////////////////////////////////////\n                                                                                 //\n/* global _DDP:true */                                                           // 1\n/* global Package: true */                                                       // 2\n/* global Meteor: true */                                                        // 3\n                                                                                 // 4\n_DDP = Package.ddp.LivedataTest;                                                 // 5\n                                                                                 // 6\nif (_DDP) {                                                                      // 7\n  _DDP = _DDP.Connection && _DDP.Connection.prototype;                           // 8\n} else {                                                                         // 9\n  _DDP = Meteor.connection.__proto__;                                            // 10\n}                                                                                // 11\n                                                                                 // 12\nif (!_DDP) {                                                                     // 13\n  throw new Error('Arg! Meteor just broke raix:stubfence! Please report to @raix at github, and he will work his butt off trying to fix this');\n}                                                                                // 15\n                                                                                 // 16\n///////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n///////////////////////////////////////////////////////////////////////////////////\n//                                                                               //\n// packages/raix:stubfence/nostub.js                                             //\n//                                                                               //\n///////////////////////////////////////////////////////////////////////////////////\n                                                                                 //\nvar inFence = 0;                                                                 // 1\n                                                                                 // 2\n_DDP.stubFence = function(names, f) {                                            // 3\n  var self = this;                                                               // 4\n                                                                                 // 5\n  if (++inFence !== 1) {                                                         // 6\n    inFence--;                                                                   // 7\n    throw new Error('stubFence cannot lock since another stubFence is running'); // 8\n  }                                                                              // 9\n                                                                                 // 10\n  // Take string or array of string                                              // 11\n  if (names === ''+names) names = [names];                                       // 12\n                                                                                 // 13\n  // Carrier for super of methods                                                // 14\n  var supers = {};                                                               // 15\n                                                                                 // 16\n  // Store supers                                                                // 17\n  _.each(names, function(name) {                                                 // 18\n                                                                                 // 19\n    // Check that the method exists                                              // 20\n    if (self._methodHandlers[name]) {                                            // 21\n      supers[name] = self._methodHandlers[name];                                 // 22\n    } else {                                                                     // 23\n      throw new Error('stubFence could not find method \"' + name + '\"');         // 24\n    }                                                                            // 25\n                                                                                 // 26\n  });                                                                            // 27\n                                                                                 // 28\n  // Check that we got any supers to stubFence                                   // 29\n  if (names.length) {                                                            // 30\n                                                                                 // 31\n    // Remove the stub                                                           // 32\n    _.each(supers, function(f, name) {                                           // 33\n      self._methodHandlers[name] = null;                                         // 34\n    });                                                                          // 35\n                                                                                 // 36\n    // Run the code                                                              // 37\n    f();                                                                         // 38\n                                                                                 // 39\n    // Insert the stub again                                                     // 40\n    _.each(supers, function(f, name) {                                           // 41\n      self._methodHandlers[name] = f;                                            // 42\n    });                                                                          // 43\n  } else {                                                                       // 44\n    throw new Error('stubFence, no methods found');                              // 45\n  }                                                                              // 46\n                                                                                 // 47\n  inFence--;                                                                     // 48\n};                                                                               // 49\n                                                                                 // 50\nMongo.Collection.prototype.stubFence = function(f) {                             // 51\n  var self = this;                                                               // 52\n                                                                                 // 53\n  // Make sure we got a collection name                                          // 54\n  if (!self._name)                                                               // 55\n    throw new Error('Dont run stubFence on an annonymous collection');           // 56\n                                                                                 // 57\n  // Make sure we got a connection                                               // 58\n  if (self._connection) {                                                        // 59\n    // The main collection methods                                               // 60\n    var collectionMethods = [                                                    // 61\n      '/' + self._name + '/insert',                                              // 62\n      '/' + self._name + '/remove',                                              // 63\n      '/' + self._name + '/update'                                               // 64\n    ];                                                                           // 65\n                                                                                 // 66\n    // Run the connection stubFence                                              // 67\n    self._connection.stubFence(collectionMethods, f);                            // 68\n                                                                                 // 69\n  } else {                                                                       // 70\n    throw new Error('Dont run stubFence on a collection with no connection');    // 71\n  }                                                                              // 72\n};                                                                               // 73\n                                                                                 // 74\n///////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}