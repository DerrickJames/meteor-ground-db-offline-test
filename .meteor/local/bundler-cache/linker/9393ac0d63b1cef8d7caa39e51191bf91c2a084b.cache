[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar _ = Package.underscore._;\nvar LocalCollection = Package.minimongo.LocalCollection;\nvar Minimongo = Package.minimongo.Minimongo;\nvar EJSON = Package.ejson.EJSON;\nvar _groundUtil = Package['ground:util']._groundUtil;\nvar Ground = Package['ground:util'].Ground;\nvar ServerTime = Package['ground:servertime'].ServerTime;\nvar EventEmitter = Package['raix:eventemitter'].EventEmitter;\nvar OneTimeout = Package['raix:onetimeout'].OneTimeout;\nvar WebApp = Package.webapp.WebApp;\nvar main = Package.webapp.main;\nvar WebAppInternals = Package.webapp.WebAppInternals;\nvar Log = Package.logging.Log;\nvar Tracker = Package.deps.Tracker;\nvar Deps = Package.deps.Deps;\nvar DDP = Package['ddp-client'].DDP;\nvar DDPServer = Package['ddp-server'].DDPServer;\nvar MongoInternals = Package.mongo.MongoInternals;\nvar Mongo = Package.mongo.Mongo;\nvar Blaze = Package.ui.Blaze;\nvar UI = Package.ui.UI;\nvar Handlebars = Package.ui.Handlebars;\nvar Spacebars = Package.spacebars.Spacebars;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar Random = Package.random.Random;\nvar MiniMax = Package['ground:minimax'].MiniMax;\nvar Store = Package['ground:store'].Store;\nvar HTML = Package.htmljs.HTML;\n\n/* Package-scope variables */\nvar _groundDbConstructor, Ground, GroundDB;\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                         //\n// packages/ground_db/packages/ground_db.js                                                //\n//                                                                                         //\n/////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                           //\n(function () {                                                                             // 1\n                                                                                           // 2\n//////////////////////////////////////////////////////////////////////////////////////     // 3\n//                                                                                  //     // 4\n// packages/ground:db/groundDB.server.js                                            //     // 5\n//                                                                                  //     // 6\n//////////////////////////////////////////////////////////////////////////////////////     // 7\n                                                                                    //     // 8\n/*                                                                                  // 1   // 9\n                                                                                    // 2   // 10\n                                                                                    // 3   // 11\nTODO:                                                                               // 4   // 12\n  `Meteor.default_server` - `Meteor.server`                                         // 5   // 13\n                                                                                    // 6   // 14\n*/                                                                                  // 7   // 15\n///////////////////////////////// TEST SCOPE ///////////////////////////////////    // 8   // 16\n                                                                                    // 9   // 17\nMeteor.server = Meteor.server || Meteor.default_server;                             // 10  // 18\n                                                                                    // 11  // 19\n//////////////////////////////// GROUND DATABASE ///////////////////////////////    // 12  // 20\n                                                                                    // 13  // 21\n_groundDbConstructor = function(collection, options) {                              // 14  // 22\n  var self;                                                                         // 15  // 23\n  // XXX: Write the grounddb constructor                                            // 16  // 24\n                                                                                    // 17  // 25\n                                                                                    // 18  // 26\n  // // This is the basic interface allowing users easily access for handling       // 19  // 27\n  // // method calls, this.super() is the super and this.collection is self         // 20  // 28\n  // // TODO: Remove this section to the README                                     // 21  // 29\n  // self.conflictHandlers = (options && options.conflictHandlers)?                 // 22  // 30\n  //       options.conflictHandlers: {                                              // 23  // 31\n  //   'insert': function(doc) {                                                    // 24  // 32\n  //     //console.log('insert');                                                   // 25  // 33\n  //     //console.log(doc);                                                        // 26  // 34\n  //     this.super(doc);                                                           // 27  // 35\n  //   },                                                                           // 28  // 36\n  //   'update': function(id, modifier) {                                           // 29  // 37\n  //     //console.log('update');                                                   // 30  // 38\n  //     //console.log(id);                                                         // 31  // 39\n  //     //console.log(modifier);                                                   // 32  // 40\n  //     this.super(id, modifier);                                                  // 33  // 41\n  //   },                                                                           // 34  // 42\n  //   'remove': function(id) {                                                     // 35  // 43\n  //     //console.log('remove');                                                   // 36  // 44\n  //     //console.log(id);                                                         // 37  // 45\n  //     this.super(id);                                                            // 38  // 46\n  //   }                                                                            // 39  // 47\n  // };                                                                             // 40  // 48\n                                                                                    // 41  // 49\n  // // Create overwrite interface                                                  // 42  // 50\n  // _.each(['insert', 'update', 'remove'], function(name) {                        // 43  // 51\n  //   // TODO: init default conflict handlers                                      // 44  // 52\n  //   //self.conflictHandlers[name] = function() {                                 // 45  // 53\n  //   //  this.super.apply(this, arguments);                                       // 46  // 54\n  //   //};                                                                         // 47  // 55\n                                                                                    // 48  // 56\n  //   // Save super                                                                // 49  // 57\n  //   var _super = Meteor.default_server.method_handlers['/'+self.name+'/'+name];  // 50  // 58\n  //   // Overwrite                                                                 // 51  // 59\n  //   Meteor.default_server.method_handlers['/'+self.name+'/'+name] = function() { // 52  // 60\n  //     var _this = this;                                                          // 53  // 61\n  //     _this.collection = self;                                                   // 54  // 62\n  //     _this.super = _super;                                                      // 55  // 63\n  //     // Call the conflicthandlers                                               // 56  // 64\n  //     self.conflictHandlers[name].apply(_this, arguments);                       // 57  // 65\n  //   };                                                                           // 58  // 66\n  // });                                                                            // 59  // 67\n                                                                                    // 60  // 68\n  return self;                                                                      // 61  // 69\n};                                                                                  // 62  // 70\n                                                                                    // 63  // 71\n                                                                                    // 64  // 72\n// Global helper for applying grounddb on a collection                              // 65  // 73\nGround.Collection = function(name, options) {                                       // 66  // 74\n  var self;                                                                         // 67  // 75\n  // Inheritance Meteor Collection can be set by options.collection                 // 68  // 76\n  // Accepts smart collections by Arunoda Susiripala                                // 69  // 77\n  // Check if user used the \"new\" keyword                                           // 70  // 78\n                                                                                    // 71  // 79\n                                                                                    // 72  // 80\n  // Make sure we got some options                                                  // 73  // 81\n  options = options || {};                                                          // 74  // 82\n                                                                                    // 75  // 83\n  // Either name is a Meteor collection or we create a new Meteor collection        // 76  // 84\n  if (name instanceof _groundUtil.Collection) {                                     // 77  // 85\n    self = name;                                                                    // 78  // 86\n  } else {                                                                          // 79  // 87\n    self = new _groundUtil.Collection(name, options);                               // 80  // 88\n  }                                                                                 // 81  // 89\n                                                                                    // 82  // 90\n  // Throw an error if something went wrong                                         // 83  // 91\n  if (!(self instanceof _groundUtil.Collection))                                    // 84  // 92\n    throw new Error('Ground.Collection expected a Mongo.Collection');               // 85  // 93\n                                                                                    // 86  // 94\n  // Add grounddb to the collection, circular reference since self is               // 87  // 95\n  // grounddb.collection                                                            // 88  // 96\n  self.grounddb = new _groundDbConstructor(self, options);                          // 89  // 97\n                                                                                    // 90  // 98\n  // Return grounded collection - We dont return this eg if it was an instance      // 91  // 99\n  // of Ground.Collection                                                           // 92  // 100\n  return self;                                                                      // 93  // 101\n};                                                                                  // 94  // 102\n                                                                                    // 95  // 103\n////////////////////////// TIMESTAMP CONFLICTHANDLER ///////////////////////////    // 96  // 104\n                                                                                    // 97  // 105\n// TODO:                                                                            // 98  // 106\n// When clients make changes the server should track the documents from the         // 99  // 107\n// clients to see if the changes are new or old changes.                            // 100\n// This could be done in several ways.                                              // 101\n// Either by versions or server timestamps - both could work.                       // 102\n//                                                                                  // 103\n// Conflicting overview:                                                            // 104\n// We could cut it down to comparing two documents and keep / broadcast the         // 105\n// winning document.                                                                // 106\n//                                                                                  // 107\n// conflictHandler = function(clientDoc, serverDoc) { return serverDoc; }           // 108\n//                                                                                  // 109\n//                                                                                  // 110\n// There should be found a way of registrating deleted documents - eg. by having    // 111\n// a flag set 'active' all nonactive documents should then be removed from          // 112\n// published documents.                                                             // 113\n//                                                                                  // 114\n// This could be a standalone package since it would introduce conflict             // 115\n// handling in generel                                                              // 116\n//                                                                                  // 117\n// Regz. RaiX                                                                       // 118\n                                                                                    // 119\n//////////////////////////////////////////////////////////////////////////////////////     // 128\n                                                                                           // 129\n}).call(this);                                                                             // 130\n                                                                                           // 131\n/////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['ground:db'] = {\n  Ground: Ground,\n  GroundDB: GroundDB\n};\n\n})();\n","servePath":"/packages/ground_db.js","sourceMap":{"version":3,"sources":["/packages/ground_db/packages/ground_db.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iG","file":"/packages/ground_db.js","sourcesContent":["(function () {\n\n//////////////////////////////////////////////////////////////////////////////////////\n//                                                                                  //\n// packages/ground:db/groundDB.server.js                                            //\n//                                                                                  //\n//////////////////////////////////////////////////////////////////////////////////////\n                                                                                    //\n/*                                                                                  // 1\n                                                                                    // 2\n                                                                                    // 3\nTODO:                                                                               // 4\n  `Meteor.default_server` - `Meteor.server`                                         // 5\n                                                                                    // 6\n*/                                                                                  // 7\n///////////////////////////////// TEST SCOPE ///////////////////////////////////    // 8\n                                                                                    // 9\nMeteor.server = Meteor.server || Meteor.default_server;                             // 10\n                                                                                    // 11\n//////////////////////////////// GROUND DATABASE ///////////////////////////////    // 12\n                                                                                    // 13\n_groundDbConstructor = function(collection, options) {                              // 14\n  var self;                                                                         // 15\n  // XXX: Write the grounddb constructor                                            // 16\n                                                                                    // 17\n                                                                                    // 18\n  // // This is the basic interface allowing users easily access for handling       // 19\n  // // method calls, this.super() is the super and this.collection is self         // 20\n  // // TODO: Remove this section to the README                                     // 21\n  // self.conflictHandlers = (options && options.conflictHandlers)?                 // 22\n  //       options.conflictHandlers: {                                              // 23\n  //   'insert': function(doc) {                                                    // 24\n  //     //console.log('insert');                                                   // 25\n  //     //console.log(doc);                                                        // 26\n  //     this.super(doc);                                                           // 27\n  //   },                                                                           // 28\n  //   'update': function(id, modifier) {                                           // 29\n  //     //console.log('update');                                                   // 30\n  //     //console.log(id);                                                         // 31\n  //     //console.log(modifier);                                                   // 32\n  //     this.super(id, modifier);                                                  // 33\n  //   },                                                                           // 34\n  //   'remove': function(id) {                                                     // 35\n  //     //console.log('remove');                                                   // 36\n  //     //console.log(id);                                                         // 37\n  //     this.super(id);                                                            // 38\n  //   }                                                                            // 39\n  // };                                                                             // 40\n                                                                                    // 41\n  // // Create overwrite interface                                                  // 42\n  // _.each(['insert', 'update', 'remove'], function(name) {                        // 43\n  //   // TODO: init default conflict handlers                                      // 44\n  //   //self.conflictHandlers[name] = function() {                                 // 45\n  //   //  this.super.apply(this, arguments);                                       // 46\n  //   //};                                                                         // 47\n                                                                                    // 48\n  //   // Save super                                                                // 49\n  //   var _super = Meteor.default_server.method_handlers['/'+self.name+'/'+name];  // 50\n  //   // Overwrite                                                                 // 51\n  //   Meteor.default_server.method_handlers['/'+self.name+'/'+name] = function() { // 52\n  //     var _this = this;                                                          // 53\n  //     _this.collection = self;                                                   // 54\n  //     _this.super = _super;                                                      // 55\n  //     // Call the conflicthandlers                                               // 56\n  //     self.conflictHandlers[name].apply(_this, arguments);                       // 57\n  //   };                                                                           // 58\n  // });                                                                            // 59\n                                                                                    // 60\n  return self;                                                                      // 61\n};                                                                                  // 62\n                                                                                    // 63\n                                                                                    // 64\n// Global helper for applying grounddb on a collection                              // 65\nGround.Collection = function(name, options) {                                       // 66\n  var self;                                                                         // 67\n  // Inheritance Meteor Collection can be set by options.collection                 // 68\n  // Accepts smart collections by Arunoda Susiripala                                // 69\n  // Check if user used the \"new\" keyword                                           // 70\n                                                                                    // 71\n                                                                                    // 72\n  // Make sure we got some options                                                  // 73\n  options = options || {};                                                          // 74\n                                                                                    // 75\n  // Either name is a Meteor collection or we create a new Meteor collection        // 76\n  if (name instanceof _groundUtil.Collection) {                                     // 77\n    self = name;                                                                    // 78\n  } else {                                                                          // 79\n    self = new _groundUtil.Collection(name, options);                               // 80\n  }                                                                                 // 81\n                                                                                    // 82\n  // Throw an error if something went wrong                                         // 83\n  if (!(self instanceof _groundUtil.Collection))                                    // 84\n    throw new Error('Ground.Collection expected a Mongo.Collection');               // 85\n                                                                                    // 86\n  // Add grounddb to the collection, circular reference since self is               // 87\n  // grounddb.collection                                                            // 88\n  self.grounddb = new _groundDbConstructor(self, options);                          // 89\n                                                                                    // 90\n  // Return grounded collection - We dont return this eg if it was an instance      // 91\n  // of Ground.Collection                                                           // 92\n  return self;                                                                      // 93\n};                                                                                  // 94\n                                                                                    // 95\n////////////////////////// TIMESTAMP CONFLICTHANDLER ///////////////////////////    // 96\n                                                                                    // 97\n// TODO:                                                                            // 98\n// When clients make changes the server should track the documents from the         // 99\n// clients to see if the changes are new or old changes.                            // 100\n// This could be done in several ways.                                              // 101\n// Either by versions or server timestamps - both could work.                       // 102\n//                                                                                  // 103\n// Conflicting overview:                                                            // 104\n// We could cut it down to comparing two documents and keep / broadcast the         // 105\n// winning document.                                                                // 106\n//                                                                                  // 107\n// conflictHandler = function(clientDoc, serverDoc) { return serverDoc; }           // 108\n//                                                                                  // 109\n//                                                                                  // 110\n// There should be found a way of registrating deleted documents - eg. by having    // 111\n// a flag set 'active' all nonactive documents should then be removed from          // 112\n// published documents.                                                             // 113\n//                                                                                  // 114\n// This could be a standalone package since it would introduce conflict             // 115\n// handling in generel                                                              // 116\n//                                                                                  // 117\n// Regz. RaiX                                                                       // 118\n                                                                                    // 119\n//////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}}]